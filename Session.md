# Session
* 서버 측의 컨테이너에서 관리되는 정보
* 일정 시간 동안 동일한 사용자(브라우저)로부터 들어오는 상태 정보를 저장하는 기술
* 서버에서 정보가 저장되는 만큼 쿠키 보다 보안면에서 유리하다.
* 세션 정보는 클라이언트가 웹 브라우저를 통해 웹 서버에 접속할 때부터 브라우저를 종료하는 시점까지 유지된다.
* 유지 시간(서버 접속 후 서버에 요청을 보내지 않는 최대 시간)은 30분이 기본 값으로, web.xml 파일에서 설정할 수 있다. 즉, 30분 이상 사용자가 서버에 요청을 보내지 않으면 자동으로 세션이 끊어지는 것이다.

<br>

사용자가 로그인에 성공하면 서버는 일종의 '클라이언트에 대한 정보가 담긴 종이'를 출력한다.    
이 종이를 반으로 찢어 하나는 사용자의 브라우저로 보내고 남은 하나는 1. 메모리(책상) 2. 하드디스크(서랍) 3. 데이터베이스(창고) 셋 중 한곳에 둔다.   
크롬, 엣지 등의 브라우저는 이 종이를 Session id라는 이름의 쿠키로 저장해놨다가 사이트에 요청을 보낼 때마다 Session id를 함께 보낸다.   
서버는 요청에 세션 아이디가 실려 오면 메모리(or 하드디스크 or 데이터베이스)에 맞는 짝이 존재하는지 찾고, 있으면 Authorization(인가, 허가) 해준다.   
이렇게 session id를 통해 사용자가 서버에 로그인 되어있음을 지속하는 상태를 session이라고 한다.   
<br>

* 메모리가 가장 빠르지만 사이트에 동시 접속하는 사용자 수가 많으면 메모리가 부족해지고, 메모리는 휘발성이기 때문에 서버가 꺼져버리면 다 날아가 버리는 문제점이 있다.
이렇게 되면 모든 사용자는 로그인이 튕겨져서 다시 로그인을 해야 한다.    
* 한편 하드디스크는 메모리 보다 속도가 느리다. 규모가 있는 서비스에서는 서버를 여러 대 운영하게 된다. 
로그인은 1번 서버, 이메일 페이지로 이동하는 것은 3번 서버로 요청하게 되면 세션 유지가 되지 않는다는 문제가 발생한다.
그렇다고 사용자의 요청을 각자 할당된 서버로만 보내는 것도 까다로운 일이다.    
* 종이 반쪽을 공용 창고인 데이터베이스 서버에 넣어서 사용할 수도 있는데 이렇게 되면 속도는 매우 느려지게 된다. 
이보다는 레디스나 MemCached 같은 메모리형 데이터베이스 서버(긴 공용 책상)를 더 흔히 사용한다.

<br>
<br>

## JWT
위처럼 서버가 복잡한 구성과 환경에서 특정 상태를 기억하는 것이 쉽지 않아, 인가를 구현하기 위해 새롭게 고안된 것이 토큰 방식 중 하나인 JWT(JSON Web Token)

* 사용자가 로그인을 하면 서버는 토큰이라는 종이를 출력해서 브라우저에 넘겨준다. 이때는 종이를 찢지 않고 통째로 준다. 즉, 서버에서 무언가를 기억하고 있지 않는다는 것.
* 토큰은 인코딩(or 암호화) 된 세 가지 데이터를 이어붙인 것(마침표를 기준으로 header, payload, verify signature 세 부분으로 나뉨)

### header
```type```과 ```alg``` 두 가지 정보를 담고 있다.
type은 토큰의 타입으로 JWT가 들어간다. alg는 알고리즘의 약자로 verify signature 값을 만드는데 사용되는 알고리즘이 지정된다. 여러 암호화 방식 중 하나를 지정할 수 있다.
### payload
Base64로 디코딩 하면 JSON 형식으로 여러 정보들이 담겨있는데,
이 토큰을 누가 누구에게 발급한 것인지, 언제까지 유효한지 등 뿐만 아니라 사용자의 닉네임 관리자 여부 등의 사용자 정보 또한 담겨있다.
(사용자 정보 등의 데이터를 Claim이라고 한다.)
요청이 발생할 때마다 이 토큰은 사용자로부터 서버한테 보내진다. 그러면 서버는 요청 시마다 데이터베이스에서 매번 검색해야 하는 일이 줄어들 수 있다.
### verify signature
```header, payload, 서버에 숨겨놓은 비밀 값``` 세 개를 alg에 넣고 돌리면 ```verify signature``` 값이 나온다.

<br>
<br>

* payload 에서 사용자의 조작 및 악용을 막기 위해 header와 verify signature가 있는 것이다.
* 서버는 요청에 토큰 값이 실려 들어오면 ```header와 payload``` 값을 ```서버의 비밀 키```와 함게 돌려서 계산된 결과 값이 ```verify signature```와 일치하는지 확인한다.
* 값이 일치하고 유효기간도 지나지 않은 상태이면 로그인 된 회원으로서 인가를 받는 것이다.
* 이렇게 시간에 따라 변경되는 상태 값을 갖지 않는 것을 ```stateless```하다고 한다. 세션은 반대로 stateful

<br>

참고    
https://www.youtube.com/watch?v=1QiOXWEbqYQ
